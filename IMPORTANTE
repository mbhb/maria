#include <sys/types.h>
#include <sys/select.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <string.h>
#include <unistd.h>
#include <stdio.h>



int main(){
    mkfifo("tuberia1",0777); 
    mkfifo("tuberia2",0777); 
    int fd1=open("./tuberia1",O_NONBLOCK|O_RDONLY);
    int fd2=open("./tuberia2",O_NONBLOCK|O_RDONLY);

    while(1){
        fd_set set;
        int bytes=0;
        FD_ZERO(&set);
        FD_SET(fd1,&set);
        FD_SET(fd2,&set);
        int valor;
        if(fd1>fd2){valor=fd1;}else{valor=fd2;}
        select(valor+1,&set,0,0,0);
        if(FD_ISSET(fd1,&set)){
            char buf[256];
            if((bytes=read(fd1,&buf,sizeof(buf)))==0){
                close(fd1);
                open("./tuberia1",O_NONBLOCK|O_RDONLY);
            }
            else{
                 buf[bytes] = '\0';
                 printf("Data from tuberia2: %s\n", buf);
            }
        }
        if(FD_ISSET(fd2,&set)){
            char buf[256];
            if((bytes=read(fd2,&buf,sizeof(buf)))==0){
                close(fd2);
                open("./tuberia2",O_NONBLOCK|O_RDONLY);
            }
            else{
                 buf[bytes] = '\0';
                 printf("Data from tuberia2: %s\n", buf);
            }
        }

    }
    close(fd2);
    close(fd1);
    return 0;
}
