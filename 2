#include <sys/types.h>
#include <sys/wait.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>



int main(int argc, char *argv[]){
    
    char buf;
    int p_h[2];
    int h_p[2];
    pid_t cpid;
    pipe(p_h);
    pipe(h_p);
    cpid=fork();

    if (cpid==0){
         char message[100];
        close(p_h[1]);
        close(h_p[0]);
        int mensaje=0;
        while (mensaje<10){
            ssize_t bytes=read(p_h[0], message, sizeof(message));
            write(STDOUT_FILENO,message, bytes);
            sleep(1);
            write(h_p[1], "1", 1);
            mensaje++;
        }
         write(h_p[1], "q", 1);

        close(p_h[0]);
        close(h_p[1]);

        _exit(EXIT_SUCCESS);

    }
    else{
        close(p_h[0]);
        close(h_p[1]);
        char message[100];
        char ge='-';
        while(ge!='q')
        {
            ssize_t bytes=read(STDIN_FILENO, message, sizeof(message));
            write(p_h[1], message, sizeof(message));
            read(h_p[0], &ge, 1);
        }

        close(p_h[1]);
        close(h_p[0]);
        wait(NULL);                /* Wait for child */
        exit(EXIT_SUCCESS);

    }

}
